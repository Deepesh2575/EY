(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9626:function(e,t,a){Promise.resolve().then(a.bind(a,6112))},6112:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return J}});var s=a(7437),r=a(2265),n=a(3464),l=a(2003);let i=n.Z.create({baseURL:l.C,timeout:3e4,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{let t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e.data,e=>{if(console.error("API Error:",e),e.response){let t=e.response.data,a=Error((null==t?void 0:t.message)||(null==t?void 0:t.detail)||"Something went wrong");return a.status=e.response.status,a.data=t,Promise.reject(a)}return e.request?Promise.reject(Error("Cannot connect to server. Please check your connection.")):Promise.reject(e)});let o=async(e,t)=>await i.post("/api/chat",{conversation_id:e,message:t}),c=async(e,t,a,s)=>{let r=new FormData;r.append("file",a);let n={params:{conversation_id:e,doc_type:t},headers:{"Content-Type":"multipart/form-data"}};return s&&(n.onUploadProgress=e=>{s(e.loaded/e.total*100)}),await i.post("/api/upload",r,n)},d=async(e,t)=>{let a=new FormData;return a.append("file",t),await i.post("/api/ocr",a,{params:{conversation_id:e},headers:{"Content-Type":"multipart/form-data"}})},m=async e=>await i.get("/api/conversation/".concat(e));function u(e){let{onSend:t}=e,[a,n]=(0,r.useState)(null),[l,i]=(0,r.useState)(!1),[o,c]=(0,r.useState)(null),[m,u]=(0,r.useState)(null),x=async()=>{if(a){i(!0);try{let e=await d("",a);c(e)}catch(e){u(e.message||"OCR failed")}finally{i(!1)}}};return(0,s.jsxs)("div",{className:"p-4 border-b border-dark-700",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"file",accept:"image/*,application/pdf",onChange:e=>{n(e.target.files[0]),c(null),u(null)}}),(0,s.jsx)("button",{onClick:x,className:"px-3 py-1 bg-primary-500 rounded text-white",disabled:l||!a,children:l?"Scanning...":"Scan Document"}),o&&(0,s.jsx)("button",{onClick:()=>{o&&t&&t(o.text||Object.values(o.fields||{}).join("\n"))},className:"px-3 py-1 bg-success-500 rounded text-white",children:"Send to chat"})]}),m&&(0,s.jsx)("div",{className:"mt-2 text-danger-400",children:m}),o&&(0,s.jsxs)("div",{className:"mt-2 text-sm bg-dark-800 p-2 rounded",children:[(0,s.jsx)("div",{className:"font-medium",children:"Extracted Text"}),(0,s.jsx)("pre",{className:"whitespace-pre-wrap text-xs",children:o.text}),o.fields&&(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("div",{className:"font-medium",children:"Parsed Fields"}),(0,s.jsx)("pre",{className:"text-xs",children:JSON.stringify(o.fields,null,2)})]})]})]})}var x=a(2252),p=a(3581),h=a(2431),g=a(5302);function f(e){let{onCapture:t,onCancel:a}=e,n=(0,r.useRef)(null),[l,i]=(0,r.useState)(null),[o,c]=(0,r.useState)(null),[d,m]=(0,r.useState)(!1),[u,f]=(0,r.useState)(null),b=(0,r.useCallback)(()=>{l&&(l.getTracks().forEach(e=>e.stop()),i(null))},[l]),y=(0,r.useCallback)(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!1});i(e),n.current&&(n.current.srcObject=e),c(null)}catch(e){console.error("Camera error:",e),c("Unable to access camera. Please allow permission.")}},[]);return((0,r.useEffect)(()=>(y(),()=>b()),[y,b]),o)?(0,s.jsxs)("div",{className:"p-6 bg-dark-800 rounded-xl border border-danger-500/30 text-center",children:[(0,s.jsx)(x.Z,{className:"w-12 h-12 text-danger-400 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-danger-300 mb-4",children:o}),(0,s.jsx)("button",{onClick:y,className:"px-4 py-2 bg-dark-700 hover:bg-dark-600 rounded-lg text-white transition-colors",children:"Try Again"})]}):(0,s.jsxs)("div",{className:"w-full max-w-md mx-auto bg-dark-800 rounded-xl border border-dark-600 overflow-hidden shadow-2xl animate-fade-in",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-dark-700 flex justify-between items-center",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,s.jsx)(p.Z,{className:"w-5 h-5 text-primary-400"}),"Video KYC Verification"]}),a&&(0,s.jsx)("button",{onClick:a,className:"text-dark-400 hover:text-white",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"relative aspect-video bg-black",children:[d?(0,s.jsx)("img",{src:u,alt:"Captured",className:"w-full h-full object-cover transform scale-x-[-1]"}):(0,s.jsx)("video",{ref:n,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover transform scale-x-[-1]"}),!d&&(0,s.jsx)("div",{className:"absolute bottom-4 left-0 right-0 text-center pointer-events-none",children:(0,s.jsx)("span",{className:"px-3 py-1 bg-black/50 text-white text-sm rounded-full backdrop-blur-sm",children:"Position your face in the center"})})]}),(0,s.jsx)("div",{className:"p-4 flex justify-center gap-4 bg-dark-800",children:d?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{onClick:()=>{m(!1),f(null),t(null)},className:"flex items-center gap-2 px-4 py-2 bg-dark-700 hover:bg-dark-600 text-dark-200 rounded-lg transition-colors",children:[(0,s.jsx)(h.Z,{className:"w-4 h-4"}),"Retake"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-success-400 font-medium animate-fade-in",children:[(0,s.jsx)(g.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Uploading..."})]})]}):(0,s.jsxs)("button",{onClick:()=>{if(n.current){let e=document.createElement("canvas");e.width=n.current.videoWidth,e.height=n.current.videoHeight,e.getContext("2d").drawImage(n.current,0,0),e.toBlob(e=>{let a=new File([e],"kyc_selfie.jpg",{type:"image/jpeg"});f(URL.createObjectURL(e)),m(!0),t(a)},"image/jpeg",.8)}},className:"flex items-center gap-2 px-6 py-2 bg-primary-500 hover:bg-primary-600 text-white rounded-full font-medium transition-all transform hover:scale-105",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-white rounded-full animate-pulse"}),"Capture Photo"]})})]})}var b=a(6202),y=a(1723),v=a(401),j=a(3639),w=a(5131),N=a(2369),k=a(2222),D=function(e){var t,a,r,n;let{message:l}=e,i="user"===l.role,o=(null===(t=l.metadata)||void 0===t?void 0:t.decision)==="APPROVED"||(null===(a=l.metadata)||void 0===a?void 0:a.decision)==="REJECTED"||(null===(r=l.metadata)||void 0===r?void 0:r.is_decision),c=(null===(n=l.metadata)||void 0===n?void 0:n.decision)==="APPROVED",d=l.isError||l.error||"failed"===l.status,m=e=>{try{let t=new Date(e),a=new Date-t,s=Math.floor(a/6e4),r=Math.floor(a/36e5),n=Math.floor(a/864e5);if(s<1)return"Just now";if(s<60)return"".concat(s,"m ago");if(r<24)return"".concat(r,"h ago");if(n<7)return"".concat(n,"d ago");return t.toLocaleDateString()}catch(e){return"Just now"}};return o?(0,s.jsx)("div",{className:"flex justify-center my-6 animate-fade-in",children:(0,s.jsxs)("div",{className:"max-w-md px-6 py-4 rounded-xl shadow-lg ".concat(c?"bg-gradient-to-r from-success-500 to-success-600 text-white":"bg-gradient-to-r from-danger-500 to-danger-600 text-white"),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[c?(0,s.jsx)(g.Z,{className:"w-6 h-6"}):(0,s.jsx)(w.Z,{className:"w-6 h-6"}),(0,s.jsx)("h3",{className:"text-lg font-bold",children:c?"Loan Approved!":"Loan Application Status"})]}),(0,s.jsx)(b.UG,{className:"prose prose-invert max-w-none text-white/90",children:l.content}),(0,s.jsx)("div",{className:"text-xs text-white/70 mt-2",children:m(l.timestamp)})]})}):(0,s.jsxs)("div",{className:"flex items-start space-x-3 mb-4 ".concat(i?"flex-row-reverse space-x-reverse":""," animate-").concat(i?"slide-in-right":"slide-in-left"),children:[(0,s.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ".concat(i?"bg-primary-600":"bg-gradient-to-br from-primary-500 to-primary-700"," shadow-lg"),children:i?(0,s.jsx)(N.Z,{className:"w-5 h-5 text-white"}):(0,s.jsx)(k.Z,{className:"w-5 h-5 text-white"})}),(0,s.jsxs)("div",{className:"flex-1 ".concat(i?"flex flex-col items-end":""),children:[(0,s.jsxs)("div",{className:"inline-block max-w-[70%] px-4 py-3 rounded-2xl ".concat(i?"bg-primary-600 text-white rounded-br-sm":"bg-dark-800 text-gray-100 rounded-bl-sm border border-dark-700"," ").concat(d?"border-2 border-danger-500":""),children:[l.file&&(0,s.jsxs)("div",{className:"mb-2 text-sm opacity-75 flex items-center space-x-1",children:[(0,s.jsx)("span",{children:"\uD83D\uDCCE"}),(0,s.jsx)("span",{children:l.file})]}),(0,s.jsx)(b.UG,{className:"prose prose-invert max-w-none prose-sm",children:l.content}),l.uploadProgress&&"pending"===l.status&&(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1 mt-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-1 rounded-full",style:{width:"".concat(l.uploadProgress,"%")}})})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-500 mt-1 px-2 ".concat(i?"justify-end":"justify-start"),children:[(0,s.jsx)("span",{children:m(l.timestamp)}),i&&(()=>{switch(l.status){case"pending":return(0,s.jsx)(y.Z,{className:"w-3 h-3 text-gray-400"});case"sent":return(0,s.jsx)(v.Z,{className:"w-3 h-3 text-green-400"});case"failed":return(0,s.jsx)(j.Z,{className:"w-3 h-3 text-red-400"});default:return null}})()]})]})]})},S=a(7117),C=a(2489),E=a(6980),_=a(4743),I=a(5846),P=function(e){let{onSend:t,onFileUpload:a,isLoading:n,uploadedFiles:l={}}=e,[i,o]=(0,r.useState)(""),[c,d]=(0,r.useState)(l),m=(0,r.useRef)(null),u=(0,r.useRef)(null);(0,r.useEffect)(()=>{d(l)},[l]);let x=e=>{null==e||e.preventDefault(),i.trim()&&!n&&(t(i),o(""))},p=e=>{t(e)},h=async e=>{let t=e.target.files[0];if(!t)return;let s="salary_slip",r=t.name.toLowerCase();r.includes("pan")||r.includes("id")?s="pan_card":r.includes("aadhaar")?s="aadhaar":(r.includes("bank")||r.includes("statement"))&&(s="bank_statement"),d(e=>({...e,[s]:{name:t.name,file:t}}));try{await a(s,t)}catch(e){d(e=>{let t={...e};return delete t[s],t})}e.target.value=""},g=e=>{d(t=>{let a={...t};return delete a[e],a})},f={salary_slip:"Salary Slip",pan_card:"PAN Card",aadhaar:"Aadhaar",bank_statement:"Bank Statement"};return(0,s.jsxs)("div",{className:"border-t border-dark-700 bg-dark-800/80 backdrop-blur-sm",children:[Object.keys(c).length>0&&(0,s.jsx)("div",{className:"px-4 pt-3 pb-2 flex flex-wrap gap-2",children:Object.entries(c).map(e=>{let[t]=e;return(0,s.jsxs)("div",{className:"flex items-center space-x-2 px-3 py-1.5 bg-success-500/20 border border-success-500/30 rounded-lg text-sm",children:[(0,s.jsx)(S.Z,{className:"w-4 h-4 text-success-500"}),(0,s.jsx)("span",{className:"text-success-400",children:f[t]||t}),(0,s.jsx)("button",{onClick:()=>g(t),className:"text-success-400 hover:text-success-300",children:(0,s.jsx)(C.Z,{className:"w-4 h-4"})})]},t)})}),(0,s.jsxs)("form",{onSubmit:x,className:"flex items-end space-x-2 px-4 py-4",children:[(0,s.jsx)("input",{ref:m,type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",onChange:h}),(0,s.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.click()},className:"p-3 bg-dark-700 hover:bg-dark-600 rounded-lg transition-colors flex-shrink-0",disabled:n,"aria-label":"Upload file",children:(0,s.jsx)(E.Z,{className:"w-5 h-5 text-gray-300"})}),(0,s.jsx)("textarea",{ref:u,value:i,onChange:e=>{let t=e.target.value;t.length<=2e3&&o(t)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),x())},placeholder:"Type your message... (Press Enter to send, Shift+Enter for new line)",className:"flex-1 px-4 py-3 bg-dark-700 border border-dark-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none min-h-[48px] max-h-32",rows:1,maxLength:2e3,disabled:n,onInput:e=>{e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+"px"}}),(0,s.jsx)("button",{type:"submit",disabled:n||!i.trim(),className:"p-3 bg-primary-600 hover:bg-primary-700 rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0 hover:shadow-lg hover:shadow-primary-500/30 hover:-translate-y-0.5","aria-label":"Send message",children:(0,s.jsx)(_.Z,{className:"w-5 h-5 text-white"})})]}),""===i&&!n&&0===Object.keys(c).length&&(0,s.jsxs)("div",{className:"px-4 pb-3 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-dark-500 mb-2",children:[(0,s.jsx)(I.Z,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Quick options:"})]}),(0,s.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,s.jsx)("button",{onClick:()=>p("I need a personal loan"),className:"bg-primary-500/20 hover:bg-primary-500/30 text-primary-300 px-3 py-1.5 rounded-full text-sm transition-colors",children:"\uD83D\uDCB0 Personal Loan"}),(0,s.jsx)("button",{onClick:()=>p("What documents do I need?"),className:"bg-primary-500/20 hover:bg-primary-500/30 text-primary-300 px-3 py-1.5 rounded-full text-sm transition-colors",children:"\uD83D\uDCCB Required Docs"}),(0,s.jsx)("button",{onClick:()=>p("Tell me about your loan products"),className:"bg-primary-500/20 hover:bg-primary-500/30 text-primary-300 px-3 py-1.5 rounded-full text-sm transition-colors",children:"ℹ️ Loan Products"})]})]})]})},O=function(){return(0,s.jsxs)("div",{className:"flex items-center space-x-2 px-4 py-3 bg-dark-800 rounded-lg w-fit",children:[(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce-dot",style:{animationDelay:"0ms"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce-dot",style:{animationDelay:"200ms"}}),(0,s.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce-dot",style:{animationDelay:"400ms"}})]}),(0,s.jsx)("span",{className:"text-sm text-gray-400 ml-2",children:"AI is typing..."})]})};let Z=[{key:"GREETING",label:"Welcome",icon:"\uD83D\uDC4B"},{key:"INFO_GATHERING",label:"Details",icon:"\uD83D\uDCDD"},{key:"VERIFICATION",label:"Verification",icon:"✓"},{key:"UNDERWRITING",label:"Review",icon:"\uD83D\uDD0D"},{key:"SANCTION",label:"Decision",icon:"✅"},{key:"COMPLETED",label:"Complete",icon:"\uD83C\uDF89"}];var R=function(e){let{currentStage:t}=e,a=Z.findIndex(e=>e.key===t),r=e=>e<a,n=e=>e===a;return(0,s.jsx)("div",{className:"w-full py-4 px-2 bg-dark-800/50 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center justify-between relative",children:[(0,s.jsx)("div",{className:"absolute top-5 left-0 right-0 h-0.5 bg-dark-700 -z-0",children:(0,s.jsx)("div",{className:"h-full bg-primary-500 transition-all duration-500",style:{width:"".concat(a/(Z.length-1)*100,"%")}})}),Z.map((e,t)=>{let a=r(t),l=n(t);return(0,s.jsxs)("div",{className:"flex flex-col items-center relative z-10",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-lg transition-all duration-300 ".concat(a?"bg-success-500 text-white":l?"bg-primary-500 text-white ring-4 ring-primary-500/30":"bg-dark-700 text-gray-500"),children:a?(0,s.jsx)(v.Z,{className:"w-5 h-5"}):(0,s.jsx)("span",{children:e.icon})}),(0,s.jsx)("span",{className:"text-xs mt-2 hidden sm:block transition-colors ".concat(l?"text-primary-400 font-semibold":a?"text-success-400":"text-gray-500"),children:e.label})]},e.key)})]})})},L=a(6858),A=a(8906),F=a(1239),T=function(e){let{onQuickStart:t}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full px-4 py-8 animate-fade-in",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-primary-500 to-primary-700 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg",children:(0,s.jsx)("span",{className:"text-4xl",children:"\uD83E\uDD16"})}),(0,s.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-2",children:"AI Loan Assistant"}),(0,s.jsx)("p",{className:"text-lg text-gray-400 mb-6",children:"Get instant loan approval in just 5 minutes"})]}),(0,s.jsxs)("div",{className:"w-full max-w-md mb-8",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-white mb-4 text-center",children:"What would you like to do?"}),(0,s.jsx)("div",{className:"space-y-3",children:[{id:"personal",label:"Personal Loan",icon:"\uD83D\uDCB3",description:"For personal needs"},{id:"business",label:"Business Loan",icon:"\uD83C\uDFE2",description:"Grow your business"},{id:"home",label:"Home Loan",icon:"\uD83C\uDFE0",description:"Buy your dream home"}].map(e=>(0,s.jsxs)("button",{onClick:()=>t(e.id),className:"w-full p-4 bg-dark-800 hover:bg-dark-700 border border-dark-700 hover:border-primary-500 rounded-lg transition-all duration-200 flex items-center justify-between group",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:e.icon}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("div",{className:"text-white font-semibold",children:e.label}),(0,s.jsx)("div",{className:"text-sm text-gray-400",children:e.description})]})]}),(0,s.jsx)(L.Z,{className:"w-5 h-5 text-gray-400 group-hover:text-primary-500 transition-colors"})]},e.id))})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 w-full max-w-2xl mt-8",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center p-4 bg-dark-800/50 rounded-lg",children:[(0,s.jsx)(y.Z,{className:"w-6 h-6 text-success-500 mb-2"}),(0,s.jsx)("span",{className:"text-sm text-gray-300 font-medium",children:"5-min approval"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center p-4 bg-dark-800/50 rounded-lg",children:[(0,s.jsx)(A.Z,{className:"w-6 h-6 text-primary-500 mb-2"}),(0,s.jsx)("span",{className:"text-sm text-gray-300 font-medium",children:"100% Secure"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center p-4 bg-dark-800/50 rounded-lg",children:[(0,s.jsx)(F.Z,{className:"w-6 h-6 text-warning-500 mb-2"}),(0,s.jsx)("span",{className:"text-sm text-gray-300 font-medium",children:"24/7 Available"})]})]})]})},G=a(4147);let U="loan_chat_",B=()=>{let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(null),[n,l]=(0,r.useState)("GREETING"),[i,d]=(0,r.useState)(!1),[u,x]=(0,r.useState)(null),[p,h]=(0,r.useState)({}),[g,f]=(0,r.useState)(null),[b,y]=(0,r.useState)(null),[v,j]=(0,r.useState)(0),w=(0,r.useRef)(null),N=(0,r.useCallback)(()=>{var e;null===(e=w.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[]);(0,r.useEffect)(()=>{N()},[e,N]),(0,r.useEffect)(()=>{let e=new URLSearchParams(window.location.search).get("conversation_id");if(e){let a=localStorage.getItem("".concat(U).concat(e));if(a)try{let r=JSON.parse(a);s(e),t(r.messages||[]),l(r.currentStage||"GREETING"),h(r.uploadedFiles||{}),f(r.isApproved||null);return}catch(e){console.error("Error recovering conversation:",e)}m(e).then(a=>{s(e),a.messages&&t(a.messages.map(e=>({id:(0,G.Z)(),role:e.role,content:e.content,timestamp:e.timestamp}))),l(a.stage||"GREETING"),f("APPROVED"===a.decision)}).catch(()=>{k()})}else k()},[]);let k=()=>{let e=(0,G.Z)();s(e),t([{id:(0,G.Z)(),role:"assistant",content:"\uD83D\uDC4B Welcome! I'm your AI Loan Officer. I can help you get instant loan approval. How can I assist you today?",timestamp:new Date().toISOString()}]),window.history.replaceState({},"","?conversation_id=".concat(e))};(0,r.useEffect)(()=>{if(a&&e.length>0){let t={messages:e,currentStage:n,uploadedFiles:p,isApproved:g,timestamp:new Date().toISOString()};localStorage.setItem("".concat(U).concat(a),JSON.stringify(t))}},[e,a,n,p,g]);let D=(0,r.useCallback)(async function(e){var r,n,i,c,m;let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e.trim())return;let p={id:(0,G.Z)(),role:"user",content:e,timestamp:new Date().toISOString(),status:"pending"};t(e=>[...e,p]),x(null),d(!0);try{let d=await o(a,e);t(e=>e.map(e=>e.id===p.id?{...e,status:"sent"}:e)),d.conversation_id&&d.conversation_id!==a&&(s(d.conversation_id),window.history.replaceState({},"","?conversation_id=".concat(d.conversation_id)));let m={id:(0,G.Z)(),role:"assistant",content:d.message||d.response||"I apologize, but I could not generate a response.",timestamp:d.timestamp||new Date().toISOString(),metadata:d.metadata||{}};t(e=>[...e,m]),(d.stage||(null===(r=d.metadata)||void 0===r?void 0:r.stage))&&l(d.stage||(null===(i=d.metadata)||void 0===i?void 0:i.stage));let u=null===(n=d.metadata)||void 0===n?void 0:n.decision;("APPROVED"===u||"REJECTED"===u)&&(f("APPROVED"===u),(null===(c=d.metadata)||void 0===c?void 0:c.sanction_letter_url)&&y(d.metadata.sanction_letter_url)),j(0)}catch(a){if(console.error("Error sending message:",a),t(e=>e.map(e=>e.id===p.id?{...e,status:"failed"}:e)),u<3&&((null===(m=a.message)||void 0===m?void 0:m.includes("connect"))||a.status>=500)){j(e=>e+1),setTimeout(()=>{D(e,u+1)},2e3*(u+1));return}x(a.message||"Failed to send message. Please try again.")}finally{d(!1)}},[a,3]),S=(0,r.useCallback)(async function(e,r){var n,i;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(r.size>5242880)throw Error("File size must be less than 5MB");if(!["image/jpeg","image/png","image/jpg","application/pdf"].includes(r.type))throw Error("Only JPG, PNG, and PDF files are allowed");let m={id:(0,G.Z)(),role:"user",content:"Uploading ".concat(e.replace("_"," "),": ").concat(r.name,"..."),timestamp:new Date().toISOString(),file:r.name,status:"pending"};t(e=>[...e,m]),d(!0),x(null);try{let i=await c(a,e,r,e=>{t(t=>t.map(t=>t.id===m.id?{...t,uploadProgress:e}:t))});return t(t=>t.map(t=>t.id===m.id?{...t,status:"sent",content:"Uploaded ".concat(e.replace("_"," "),": ").concat(r.name)}:t)),i.conversation_id&&i.conversation_id!==a&&(s(i.conversation_id),window.history.replaceState({},"","?conversation_id=".concat(i.conversation_id))),h(t=>({...t,[e]:{name:r.name,uploaded:!0}})),t(t=>[...t,{id:(0,G.Z)(),role:"assistant",content:"✅ ".concat(e.replace("_"," ")," uploaded successfully! We're processing it now."),timestamp:new Date().toISOString()}]),(null===(n=i.metadata)||void 0===n?void 0:n.stage)&&l(i.metadata.stage),i}catch(a){if(console.error("Error uploading file:",a),x(a.message||"Failed to upload file. Please try again."),t(e=>e.map(e=>e.id===m.id?{...e,status:"failed",content:"❌ Failed to upload ".concat(r.name)}:e)),o<3&&((null===(i=a.message)||void 0===i?void 0:i.includes("connect"))||a.status>=500)){j(e=>e+1),setTimeout(()=>{S(e,r,o+1)},2e3*(o+1));return}throw a}finally{d(!1)}},[a,3]);return{messages:e,conversationId:a,currentStage:n,isTyping:i,error:u,uploadedFiles:p,isApproved:g,sanctionLetterUrl:b,retryCount:v,messagesEndRef:w,handleSendMessage:D,handleFileUpload:S,setError:x}};var V=a(2735),z=function(){let{messages:e,conversationId:t,currentStage:a,isTyping:n,error:l,uploadedFiles:i,sanctionLetterUrl:o,messagesEndRef:c,handleSendMessage:d,handleFileUpload:m,setError:p}=B(),h=async e=>{await d({personal:"I'm interested in a personal loan",business:"I need a business loan",home:"I want to apply for a home loan"}[e]||"I need a loan")};return(0,r.useEffect)(()=>{let e=e=>{if((e.metaKey||e.ctrlKey)&&"k"===e.key){e.preventDefault();let t=document.querySelector('textarea[placeholder*="Type your message"]');null==t||t.focus()}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,s.jsxs)("div",{className:"flex flex-col h-full max-w-5xl mx-auto bg-dark-800 rounded-xl shadow-2xl border border-dark-700 overflow-hidden",children:[e.length>0&&(0,s.jsx)("div",{className:"px-4 pt-4 pb-2 border-b border-dark-700",children:(0,s.jsx)(R,{currentStage:a})}),l&&(0,s.jsxs)("div",{className:"mx-4 mt-4 p-3 bg-danger-500/20 border border-danger-500/30 rounded-lg flex items-center space-x-2 text-danger-400 text-sm animate-fade-in",children:[(0,s.jsx)(x.Z,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:l}),(0,s.jsx)("button",{onClick:()=>p(null),className:"ml-auto text-danger-400 hover:text-danger-300",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-6 space-y-4 scroll-smooth",style:{scrollBehavior:"smooth"},children:[0===e.length?(0,s.jsx)(T,{onQuickStart:h}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-center mb-6 animate-fade-in",children:(0,s.jsx)("div",{className:"inline-block px-4 py-2 bg-primary-500/20 border border-primary-500/30 rounded-full",children:(0,s.jsx)("p",{className:"text-sm text-primary-300",children:"\uD83D\uDC4B Welcome! I'm your AI Loan Officer. Let's get started!"})})}),e.map((e,t)=>(0,s.jsx)(D,{message:e},e.id||t)),n&&(0,s.jsx)(O,{})]}),(0,s.jsx)("div",{ref:c})]}),o&&(0,s.jsxs)("div",{className:"mx-4 mb-2 p-3 bg-success-500/20 border border-success-500/30 rounded-lg flex items-center justify-between animate-fade-in",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(V.Z,{className:"w-5 h-5 text-success-400"}),(0,s.jsx)("span",{className:"text-success-400 font-medium",children:"Sanction letter ready!"})]}),(0,s.jsx)("a",{href:o,download:!0,className:"px-4 py-2 bg-success-500 hover:bg-success-600 rounded-lg text-white text-sm transition-colors",children:"Download PDF"})]}),(0,s.jsx)(u,{onSend:d}),"VIDEO_KYC"===a&&!i.video_kyc_selfie&&(0,s.jsx)("div",{className:"absolute inset-0 z-50 bg-black/80 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",children:(0,s.jsx)(f,{onCapture:e=>{e&&m("video_kyc_selfie",e)}})}),(0,s.jsx)(P,{onSend:d,onFileUpload:m,isLoading:n,conversationId:t,uploadedFiles:i,disabled:"VIDEO_KYC"===a&&!i.video_kyc_selfie})]})};function J(){let[e,t]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{t(!0)},[]),e)?(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center px-4 py-8",children:(0,s.jsx)(z,{})}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-dark-900",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-dark-600",children:"Loading..."})]})})}},2003:function(e,t,a){"use strict";a.d(t,{C:function(){return s}});let s="http://localhost:8000"}},function(e){e.O(0,[159,896,971,117,744],function(){return e(e.s=9626)}),_N_E=e.O()}]);